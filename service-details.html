<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="UstaHub - Service Details">
    <meta name="author" content="UstaHub">
    <link rel="shortcut icon" href="assets/img/favicon.ico">


    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700|Varela+Round" rel="stylesheet">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="assets/css/selectize.css" type="text/css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/rtl.css" id="rtl-stylesheet" disabled>
    <link rel="stylesheet" href="assets/css/user.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/page-hero.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <!-- AOS Animation Script -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });
        });
    </script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="assets/css/mobile-sidebar.css">
    <link rel="stylesheet" href="assets/css/bottom-navbar.css">
    <link rel="stylesheet" href="assets/css/navbar-hero-spacing-fix.css">
    <link rel="stylesheet" href="assets/css/top-navbar.css">
    <link rel="stylesheet" href="assets/css/font-awesome-colors.css">
    <link rel="stylesheet" href="assets/css/hero-carousel.css">

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
    <!-- Custom JS -->
    <script type="module" src="assets/js/supabase.js"></script>
    <script src="assets/js/navbars.js"></script>

    <title>Service Details - UstaHub</title>

</head>
<body>

    <!-- Mount point for detached dropdown list (for custom dropdown, must be outside all containers) -->
    <div id="dropdown-mount"></div>
    <!-- React Hero Section Mount Point -->
    <div id="react-hero"></div>

    <div class="page">
        <div class="hero-header hero-service-details">
        <div class="overlay"></div>
        <div id="navbar-top"></div>
        <div id="navbar-bottom"></div>
        <div class="hero-content">
            <div class="container">
                <h1 class="center" id="serviceTitle">Loading...</h1>
                <p class="subtitle" id="serviceDescription"></p>
            </div>
        </div>
    </div>
    <main class="service-details-container">
        <div class="loading-spinner" id="loadingSpinner">
            <i class="fas fa-spinner"></i>
        </div>
        <div class="service-content">
            <div class="service-section" data-aos="fade-up">
                <h2>About This Service</h2>
                <p id="serviceAbout"></p>
                <div class="subcategories-list" id="subcategoriesList"></div>
            </div>
            <div class="service-section" data-aos="fade-up" data-aos-delay="100">
                <h2>What We Offer</h2>
                <div class="service-features" id="serviceFeatures"></div>
            </div>
            <div class="cta-section" data-aos="fade-up" data-aos-delay="200">
                <div class="cta-buttons">
                    <button class="btn btn-primary btn-lg book-service-btn" id="bookServiceButton">
                        <i class="fas fa-calendar-check me-2"></i>Book This Service
                    </button>
                    <a href="#" class="btn btn-outline-primary btn-lg" id="contactButton">
                        <i class="fas fa-envelope me-2"></i>Contact Provider
                    </a>
                </div>
                <div class="service-provider-info" id="providerInfo" class="hidden">
                    <div class="provider-card">
                        <div class="provider-details">
                            <h4 id="providerName">Provider Name</h4>
                            <p id="providerSpecialty">Specialty</p>
                            <div class="provider-rating">
                                <span class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half"></i>
                                </span>
                                <span class="rating-text">4.8 (120+ reviews)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- JavaScript -->
    </div>
    <!--end page-->


    
    
    
    
    
    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        // Function to create feature item with animation
        function createFeatureItem(feature, index) {
            const item = document.createElement('div');
            item.className = 'feature-item';
            item.setAttribute('data-aos', 'fade-up');
            item.setAttribute('data-aos-delay', index * 100);
            item.innerHTML = `
                <i class="fa ${feature.icon}"></i>
                <div>
                    <h3>${feature.title}</h3>
                    <p>${feature.description}</p>
                </div>
            `;
            return item;
        }
        // Function to show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.querySelector('.service-content').style.display = 'none';
        }
        // Function to hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.querySelector('.service-content').style.display = 'block';
        }
        // Function to load and display service details with animations
        async function loadServiceDetails() {
            const serviceId = getUrlParameter('serviceId');
            showLoading();
            try {
                const { data: service, error } = await window.supabase
                    .from('services')
                    .select(`
                        *,
                        provider:profiles!services_provider_id_fkey(
                            id, first_name, last_name, phone
                        )
                    `)
                    .eq('id', serviceId)
                    .single();
                if (error || !service) throw error || new Error('Service not found');
                // Update service header with animation
                const title = document.getElementById('serviceTitle');
                const description = document.getElementById('serviceDescription');
                title.textContent = service.title || service.name;
                description.textContent = service.description;
                // Update page title
                document.title = `${service.title || service.name} - UstaHub`;
                // Update about section
                document.getElementById('serviceAbout').textContent =
                    `Welcome to our ${service.title || service.name} service. We provide professional ${(service.title || service.name).toLowerCase()} solutions tailored to your needs. Our team of experts is dedicated to delivering high-quality service and ensuring your complete satisfaction.`;
                // Populate subcategories with animation (if available)
                const subcategoriesList = document.getElementById('subcategoriesList');
                if (service.subcategories && Array.isArray(service.subcategories)) {
                subcategoriesList.innerHTML = service.subcategories
                    .map((sub, index) => `<span data-aos="fade-up" data-aos-delay="${index * 100}">${sub}</span>`)
                    .join('');
                } else {
                    subcategoriesList.innerHTML = `<span data-aos="fade-up">${service.category}</span>`;
                }
                // Populate features with staggered animation
                const serviceFeatures = document.getElementById('serviceFeatures');
                const features = [
                    {
                        icon: 'fa-check-circle',
                        title: 'Professional Service',
                        description: 'Experienced and certified professionals'
                    },
                    {
                        icon: 'fa-clock',
                        title: 'Quick Response',
                        description: 'Fast and efficient service delivery'
                    },
                    {
                        icon: 'fa-star',
                        title: 'Quality Guaranteed',
                        description: 'High-quality workmanship and materials'
                    },
                    {
                        icon: 'fa-shield-alt',
                        title: 'Reliable & Trusted',
                        description: 'Trusted by thousands of customers'
                    }
                ];
                serviceFeatures.innerHTML = '';
                features.forEach((feature, index) => {
                    const featureItem = createFeatureItem(feature, index);
                    serviceFeatures.appendChild(featureItem);
                });
                // Update contact button
                document.getElementById('contactButton').href = `contact.html?service=${service.id}`;
                // Update provider info if available
                if (service.provider) {
                    const providerName = `${service.provider.first_name} ${service.provider.last_name}`;
                    document.getElementById('providerName').textContent = providerName;
                    document.getElementById('providerSpecialty').textContent = service.category || 'Professional Service Provider';
                    document.getElementById('providerInfo').style.display = 'block';
                }
                // Add booking button functionality
                const bookButton = document.getElementById('bookServiceButton');
                bookButton.setAttribute('data-service-id', service.id);
                bookButton.setAttribute('data-provider-id', service.provider_id);
                bookButton.setAttribute('data-service-title', service.title || service.name);
                bookButton.addEventListener('click', async function(e) {
                    e.preventDefault();
                    const serviceId = this.getAttribute('data-service-id');
                    const providerId = this.getAttribute('data-provider-id');
                    const serviceTitle = this.getAttribute('data-service-title');
                    // Check if user is logged in
                    const { data: { user }, error } = await window.supabase.auth.getUser();
                    if (error || !user) {
                        // Redirect to sign in page
                        window.location.href = '/sign-in.html?redirect=' + encodeURIComponent(window.location.href);
                        return;
                    }
                    // Open booking modal
                    if (window.openBookingModal) {
                        window.openBookingModal(serviceId, providerId, serviceTitle);
                    } else {
                        alert(`Booking functionality coming soon!\nService: ${serviceTitle}\nService ID: ${serviceId}`);
                    }
                });
                hideLoading();
            } catch (error) {
                console.error('Error loading service details:', error);
                document.getElementById('serviceTitle').textContent = 'Error';
                document.getElementById('serviceDescription').textContent = 'There was an error loading the service details. Please try again later.';
                document.querySelector('.service-content').innerHTML = '';
                hideLoading();
            }
        }
        // Load service details when the page loads
        document.addEventListener('DOMContentLoaded', loadServiceDetails);
    </script>
    <!-- Include Booking Modal Component -->
    <div id="bookingModalContainer"></div>
    <!-- Include Booking Modal JavaScript -->
    <script src="assets/js/booking-modal.js"></script>
    <script>
        // Load booking modal component
        fetch('assets/components/booking-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('bookingModalContainer').innerHTML = html;
                // Wait a moment for DOM to update
                setTimeout(() => {
                    // Initialize booking modal after HTML is loaded
                    if (typeof BookingModal !== 'undefined') {
                        try {
                            window.bookingModal = new BookingModal();
                            // Global function to open booking modal
                            window.openBookingModal = function(serviceId, providerId, serviceTitle) {
                                console.log('Opening booking modal for:', serviceTitle);
                                window.bookingModal.openModal(serviceId, providerId, serviceTitle);
                            };
                            console.log('Booking modal initialized successfully');
                        } catch (error) {
                            console.error('Error initializing booking modal:', error);
                        }
                    } else {
                        console.error('BookingModal class not found');
                    }
                }, 100);
            })
            .catch(error => {
                console.error('Error loading booking modal:', error);
            });
    </script>
                        <div class="mb-3">
                            <label for="duration" class="form-label">Duration (hours)</label>
                            <input type="number" class="form-control" id="duration" name="duration" min="1" max="24" step="0.5" required>
                            <div class="invalid-feedback">Please enter a valid duration (1-24 hours)</div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Service Location</label>
                            <textarea class="form-control" id="address" name="address" rows="2" required></textarea>
                            <div class="invalid-feedback">Please enter the service location</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" pattern="[0-9]{10}" required>
                                <div class="invalid-feedback">Please enter a valid 10-digit phone number</div>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                                <div class="invalid-feedback">Please enter a valid email</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="instructions" class="form-label">Special Instructions (Optional)</label>
                            <textarea class="form-control" id="instructions" name="instructions" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Preferred Payment Method</label>
                            <select class="form-select" id="paymentMethod" name="paymentMethod" required>
                                <option value="">Select payment method</option>
                                <option value="cash">Cash</option>
                                <option value="online">Online</option>
                                <option value="card">Card</option>
                            </select>
                            <div class="invalid-feedback">Please select a payment method</div>
                        </div>
                        <div class="alert alert-info">
                            <small>
                                <strong>Note:</strong>
                                <ul class="mb-0">
                                    <li>The final price will be confirmed by the service provider after reviewing your requirements.</li>
                                    <li>Your booking reference will be generated automatically.</li>
                                    <li>You will receive a confirmation email once the booking is confirmed.</li>
                                </ul>
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitBooking">Book Now</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Inject sidebar HTML and load sidebar JS after HTML is present -->
    <script>
        fetch('/components/mobile-sidebar.html')
            .then(res => res.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
                var script = document.createElement('script');
                script.src = '/assets/js/mobile-sidebar.js';
                document.body.appendChild(script);
            });
    </script>
<script src="assets/js/jquery-3.3.1.min.js"></script>


<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBEDfNcQRmKQEyulDN8nGWjLYPm8s4YB58&libraries=places"></script>
<script src="assets/js/selectize.min.js"></script>
<script src="assets/js/masonry.pkgd.min.js"></script>
<script src="assets/js/icheck.min.js"></script>
<script src="assets/js/jquery.validate.min.js"></script>
<script src="assets/js/custom.js"></script>
<script src="assets/js/custom-dropdown.js"></script>
<script src="assets/js/dashboard.js"></script>
<script src="assets/js/hero-carousel.js"></script>

<!-- For integrating with Mobile Sidebar -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Load mobile sidebar with absolute path
    fetch('components/mobile-sidebar.html')
      .then(res => {
        if (!res.ok) {
          // Try with a different path if the first attempt fails
          return fetch('/components/mobile-sidebar.html');
        }
        return res;
      })
      .then(res => res.text())
      .then(html => {
        // Insert sidebar HTML
        document.body.insertAdjacentHTML('beforeend', html);
        
        // Load mobile sidebar script
        var sidebarScript = document.createElement('script');
        sidebarScript.src = 'assets/js/mobile-sidebar.js';
        document.body.appendChild(sidebarScript);

      })
      .catch(error => {
        console.error('Error loading mobile sidebar:', error);
      });
  });
</script>
</body>
</html>